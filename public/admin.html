<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ClayByMarienne Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="ClayByMarienne - Handcrafted claywares rooted in African heritage and healing." />
  <meta name="keywords" content="clay, handmade, Nigeria pottery, detox bowl, clay cookware, clay bottle" />
  <meta name="author" content="ClayByMarienne" />
  <link rel="icon" href="assets/favicon.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<!-- Developer Credits -->
<footer class="site-footer">
  Crafted by <strong>Moshood Abiola</strong> ‚Äî Web Developer & Clay Enthusiast<br/>
  <a href="https://wa.me/2348139021249">Chat with me</a>
  <a href="mailto:abiolamoshood11@gmail.com">Contact me</a>
</footer>
<body>

  <h1>ClayByMarienne Admin Dashboard</h1>

  <!-- üìä Stats -->
  <section>
    <h2>üìä Dashboard Stats</h2>
    <div id="stats-panel">
      <p><strong>Total Products:</strong> <span id="stat-products">0</span></p>
      <p><strong>Total Orders:</strong> <span id="stat-orders">0</span></p>
      <p><strong>Total Revenue:</strong> ‚Ç¶<span id="stat-revenue">0</span></p>
    </div>
  </section>

  <!-- ‚ûï Add Product -->
  <section>
    <h2>‚ûï Add Product</h2>
    <form id="quick-add-form" style="margin-bottom: 2rem;">
      <input type="text" id="new-name" placeholder="Product Name" required />
      <input type="text" id="new-type" placeholder="Type (e.g. Mug)" required />
      <input type="number" id="new-price" placeholder="Price (‚Ç¶)" required />
      <input type="text" id="new-image" placeholder="Image URL" required />
      <input type="number" id="new-stock" placeholder="Stock Qty" required />
      <label><input type="checkbox" id="new-flag" /> Mark as New Arrival</label><br/><br/>
      <button type="submit">Add Product</button>
    </form>
  </section>

  <!-- üõçÔ∏è Products -->
  <section>
    <h2>üõçÔ∏è Products</h2>
    <div id="admin-products"></div>
  </section>

  <!-- üì¶ Orders -->
  <section>
    <h2>üì¶ Orders</h2>
    <div id="admin-orders"></div>
  </section>

  <script>
    // Toast Message
    function showToast(message) {
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }

    // Load stats
    async function loadStats() {
      try {
        const res = await fetch("http://localhost:5005/stats");
        const stats = await res.json();
        document.getElementById("stat-products").textContent = stats.products;
        document.getElementById("stat-orders").textContent = stats.orders;
        document.getElementById("stat-revenue").textContent = stats.revenue.toLocaleString();
      } catch (err) {
        console.error("‚ùå Stats error:", err);
        document.getElementById("stats-panel").innerHTML = "<p>Error loading stats.</p>";
      }
    }

    // Load products
    async function loadProducts() {
      const res = await fetch("http://localhost:5005/products");
      const products = await res.json();
      const container = document.getElementById("admin-products");
      container.innerHTML = products.map(p => `
  <div class="product-tile">
    <img src="${p.image}" alt="${p.name}" loading="lazy" />
    <div class="tile-content">
      <strong>${p.name}</strong> (${p.type})<br/>
      ‚Ç¶${p.price.toLocaleString()}<br/>
      Stock: ${p.stock}<br/>
      ${p.newItem ? "<span class='new-badge'>üÜï New Arrival</span>" : ""}
      <div id="edit-form-${p._id}" style="display:none; margin-top:1rem;">
        <input type="text" id="name-${p._id}" value="${p.name}" />
        <input type="text" id="type-${p._id}" value="${p.type}" />
        <input type="number" id="price-${p._id}" value="${p.price}" />
        <input type="number" id="stock-${p._id}" value="${p.stock}" />
        <textarea id="desc-${p._id}" rows="2">${p.description || ""}</textarea>
        <button onclick="saveProduct('${p._id}')">Save</button>
      </div>
      <div class="tile-actions">
        <button onclick="toggleEdit('${p._id}')">Edit</button>
        <button onclick="deleteProduct('${p._id}')">Delete</button>
      </div>
    </div>
  </div>
`).join("");
    }

    function toggleEdit(id) {
      const form = document.getElementById(`edit-form-${id}`);
      form.style.display = form.style.display === "none" ? "block" : "none";
    }

    async function saveProduct(id) {
      const updated = {
        name: document.getElementById(`name-${id}`).value,
        type: document.getElementById(`type-${id}`).value,
        price: parseFloat(document.getElementById(`price-${id}`).value),
        stock: parseInt(document.getElementById(`stock-${id}`).value),
        description: document.getElementById(`desc-${id}`).value
      };
      await fetch(`http://localhost:5005/products/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updated)
      });
      showToast("‚úÖ Product updated!");
      loadProducts();
      loadStats();
    }

    async function deleteProduct(id) {
      if (!confirm("Delete this product?")) return;
      await fetch(`http://localhost:5005/products/${id}`, { method: "DELETE" });
      showToast("üóëÔ∏è Product deleted");
      loadProducts();
      loadStats();
    }

    document.getElementById("quick-add-form")?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const product = {
        name: document.getElementById("new-name").value.trim(),
        type: document.getElementById("new-type").value.trim(),
        price: parseFloat(document.getElementById("new-price").value),
        image: document.getElementById("new-image").value.trim(),
        stock: parseInt(document.getElementById("new-stock").value),
        newItem: document.getElementById("new-flag").checked
      };

      try {
        const res = await fetch("http://localhost:5005/products", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(product)
        });

        if (res.ok) {
          showToast("‚úÖ Product added!");
          e.target.reset();
          loadProducts();
          loadStats();
        } else {
          showToast("‚ùå Failed to add product");
        }
      } catch (err) {
        console.error("‚ùå Error adding product:", err);
        showToast("‚ùå Network error");
      }
    });

    // Load orders
    async function loadOrders() {
      const res = await fetch("http://localhost:5005/orders");
      const orders = await res.json();
      const container = document.getElementById("admin-orders");
      container.innerHTML = orders.map(o => `
        <div class="card order-list">
          <strong>${o.customerName}</strong> (${o.customerPhone})<br/>
          <em>Status:</em> ${o.status}
          <div class="status-control">
            <label>Update status:</label>
            <select onchange="updateOrderStatus('${o._id}', this.value)">
              <option value="">--Change--</option>
              <option value="Pending">Pending</option>
              <option value="Shipped">Shipped</option>
              <option value="Delivered">Delivered</option>
            </select>
          </div>
          <ul>
            ${o.cart.map(i => `<li>${i.name} x ${i.qty} ‚Äî ‚Ç¶${(i.price * i.qty).toLocaleString()}</li>`).join("")}
          </ul>
        </div>
      `).join("");
    }

    async function updateOrderStatus(id, status) {
      if (!status) return;
      await fetch(`http://localhost:5005/orders/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status })
      });
      showToast(`‚úÖ Order marked as ${status}`);
      loadOrders();
    }
    // Initialize
     window.addEventListener("DOMContentLoaded", () => {
      loadStats();
      loadProducts();
      loadOrders();
    });
  </script>

</body>
</html>